import os
import pysam
import pull_files as p

import boto3
import os
import argparse

client=boto3.client('s3','us-east-1')
from boto3.s3.transfer import S3Transfer
from boto3.s3.transfer import TransferConfig
from boto3 import utils

def copy_from_requester_pay_bucket(sample_file=None):
	config = TransferConfig(
	multipart_threshold=25 * 1024 * 1024,\
        multipart_chunksize=25 * 1024 * 1024,\
        max_concurrency=10,num_download_attempts=10,)
	transfer=S3Transfer(client, config)
	sample_file=sample_file
	os.makedirs((os.path.dirname(sample_file)))
	transfer.download_file('sscwgs',sample_file,sample_file,extra_args={'RequestPayer':'requester'})

if config == {}:
    configfile: "config.json"

SAMPLE_BAM = config["sample_bam"]
SAMPLE_BAI = config["sample_bai"]

rule get_files_from_requester_pay_bucket:
    input: copy_from_requester_pay_bucket(SAMPLE_BAM) , copy_from_requester_pay_bucket(SAMPLE_BAI)
    output: touch(SAMPLE_BAM) , touch(SAMPLE_BAI)
    run :
        pass
#    shell: """python pull_files.py --sample_file {input[0]} ; python pull_files.py --sample_file {input[1]}"""
